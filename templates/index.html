<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI å¥³å‹é™ªä¼´ç³»ç»Ÿ</title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="chat-container">
    <header class="chat-header">
        <h1>ğŸ’— æˆ‘çš„ AI å¥³å‹</h1>
        <div class="personality">
            <label>æ€§æ ¼ï¼š</label>
            <select id="personality" onchange="changePersonality()">
                <option value="clingy">é»äºº</option>
                <option value="cool">é«˜å†·</option>
                <option value="wise">çŸ¥æ€§</option>
            </select>
        </div>
    </header>

    <div id="chatbox" class="chat-box">
        <div class="ai msg">ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·å‘€ï½</div>
    </div>

    <div class="input-area">
        <input id="msg" placeholder="å’Œå¥¹è¯´ç‚¹ä»€ä¹ˆâ€¦" />
        <button onclick="sendMessage()">å‘é€</button>
    </div>
</div>

<script>
async function sendMessage() {
    const input = document.getElementById("msg");
    const text = input.value.trim();
    if (!text) return;
    input.value = "";

    const chatbox = document.getElementById("chatbox");
    chatbox.innerHTML += `<div class="user msg">${text}</div>`;
    chatbox.scrollTop = chatbox.scrollHeight;

    const res = await fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: text})
    });
    const data = await res.json();
    chatbox.innerHTML += `<div class="ai msg">${data.reply}</div>`;
    chatbox.scrollTop = chatbox.scrollHeight;
}

async function changePersonality() {
    const sel = document.getElementById("personality").value;
    await fetch("/set_personality", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({personality: sel})
    });
    const chatbox = document.getElementById("chatbox");
    chatbox.innerHTML += `<div class="ai msg system">æ€§æ ¼å·²åˆ‡æ¢ä¸ºï¼š${sel}</div>`;
    chatbox.scrollTop = chatbox.scrollHeight;
}

// å›è½¦å‘é€
document.getElementById("msg").addEventListener("keydown", function(e){
    if(e.key === "Enter") sendMessage();
});
</script>
</body>
</html>
